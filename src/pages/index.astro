---
import Layout from '../layouts/Layout.astro';
import Spotify from '../components/Spotify.astro';
import Project from '../components/Project.astro';
import ChatBot from '../components/ChatBot.jsx';
import '../styles/hover.css';

const projects = [
  {
    title: "twitter-aura2",
    languages: "Svelte, Tailwind, Node.js, Vercel, MongoDB",
    description: "The viral twitter color palette analyzer. Over 500k profiles analyzed.",
    github: "https://github.com/ronthekiehn/twitter-aura2",
    url: "https://twitter-aura2.vercel.app"
  },
  {
    title: "Cube-Web",
    languages: "C, JavaScript, WASM, GitHub Pages",
    description: "The ASCII spinning cube is now in your browser with the power of WASM.",
    github: "https://github.com/ronthekiehn/cube-web",
    url: "https://ronthekiehn.github.io/cube-web/"
  },
  {
    title: "Sky Alerts (WIP)",
    languages: "React Native, Expo, Firebase, GCP",
    description: "An app that sends alerts for astronomical events. Releasing later this year.",
  },
  {
    title: "AI Review Consensus",
    languages: "JavaScript, Gemini API, Vercel",
    description: "Chrome extension that writes an AI-generated review consensus on Goodreads.com.",
    github: "https://github.com/ronthekiehn/Goodreads",
    url: "https://chromewebstore.google.com/detail/review-consensus-for-good/klpimcobgdoeidognoplffkaajjialid?authuser=0&hl=en"
  },
  {
    title: "Billion-Visualizer",
    languages: "Python, Matplotlib",
    description: "A more concrete visualizer for @bddicken's language comparison project",
    github: "https://github.com/ronthekiehn/billion-visualizer",
  },
  {
    title: "Nootunez.com (WIP)",
    languages: "HTML/CSS/JS, Node.js, Spotify API, Heroku, Vercel, Firebase",
    description: "Generate unique Spotify recommendations. Awaiting API extension for release.",
    github: "https://github.com/ronthekiehn/BetterSpotifyRecs",
  },
  {
    title: "DAWand Blender (WIP)",
    languages: "Python, PyTorch, Blender API",
    description: "Add-on that runs Richard Liu and 3DL's DAWand in Blender. Releasing Fall 2024.",
    url: "https://github.com/threedle/DA-Wand"
  },
  {
    title: "Daily Aurelius",
    languages: "JavaScript, Python",
    description: "Chrome extension that shows a new quote from Meditations every day.",
    github: "https://github.com/ronthekiehn/Daily-Aurelius",
    url: "https://chromewebstore.google.com/detail/daily-aurelius/pnmaadcfpnogifckbhhbmfflkbjoekji"
  },
  {
    title: "Sexy Screen (WIP)",
    languages: "Python",
    description: "An open source alternative to screen recording tools like ScreenStudio.",
  },
  {
    title: "Haskell-Cube (WIP)",
    languages: "Haskell, Javascript",
    description: "Recreating my Cube project in Haskell. Hoping to make a web version.",
    github: "https://github.com/ronthekiehn/Cube"
  },
  {
    title: "Cube",
    languages: "C, Python",
    description: "Takes a simple ASCII cube and adds a ton of features.",
    github: "https://github.com/ronthekiehn/Cube"
  },
  {
    title: "Dune2Risk",
    languages: "Python, PyGame",
    description: "Uncommon Hacks 2024 Best Game Winner. It's like Risk but Dune, made in Pygame.",
    github: "https://github.com/ethaneig/dune2risk",
    url: "https://uncommon-hacks-2024.devpost.com/project-gallery"
  },
  {
    title: "PopPriceGuide Scraper",
    languages: "Python, Selenium, BeautifulSoup, re",
    description: "A small web scraper for PopPriceGuide to find the price of a Funko Pop.",
    github: "https://github.com/ronthekiehn/FunkoPop-Scraper"
  },
];
---

<Layout title="ron kiehn dot dev">
	<div class="max-w-5xl w-full p-4 sm:p-8">
		<div class="flex flex-col justify-center">
			<div class="flex justify-between mb-4">
				<h1 class="text-3xl md:text-5xl mr-2 md:mr-0">ron kiehn dot dev</h1>
				<Spotify />
			</div>
      <div class="grid grid-cols-5 text-base sm:text-lg">
        <div class="col-span-5 sm:col-span-3 space-y-4">
          <div class="flex flex-col">
            <span class="font-bold">about me</span>
            <span>cs & philosophy @ <span class="text-red-400">uchicago</span>.</span>
            <span>i do frontend, fullstack, and machine learning</span>
          </div>
          <div class="my-2 relative divider h-[2px] w-full bg-gray-600">
            <div class="absolute inset-0 bg-gradient-radial z-10"></div>
          </div>

          <div class="flex flex-col">
            <span class="font-bold">programming</span>
            <span>i mainly code in <span class="text-blue-300">c</span>, <span class="text-orange-300">python</span> and <span class="text-yellow-300">javascript</span>.</span>
            <span>but i'm learning <span class="text-blue-300">typescript</span>, <span class="text-red-500">rust</span>, and <span class="text-purple-400">haskell.</span></span>
          </div>
          <div class="relative divider h-[2px] w-full bg-gray-600">
            <div class="absolute inset-0 bg-gradient-radial z-10"></div>
          </div>
        
          <div class="flex flex-col">
            <span class="font-bold">hire me</span>
            <span>ronki [at] uchicago [dot] edu</span>
            <span>or find me on 
              <a href="https://github.com/ronthekiehn" target="_blank" rel="noreferrer" class="text-yellow-200 hover:underline">github</a>,
              <a href="https://www.linkedin.com/in/ron-kiehn-a41932235/" target="_blank" rel="noreferrer" class="text-blue-500 hover:underline">linkedin</a>,
              and 
              <a href="https://x.com/rrawnyy" target="_blank" rel="noreferrer" class="text-blue-200 hover:underline">twitter</a>.
            </span>
          </div>
    
         
          
        </div>
        <div id="cube-container" class="hidden sm:flex h-full relative col-span-2 w-full max-h-[300px] justify-center items-center aspect-square overflow-hidden"></div>
      </div>
      <div class="space-y-4 mt-4 text-base sm:text-lg">
        <div class="relative divider h-[2px] w-full bg-gray-600">
          <div class="absolute inset-0 bg-gradient-radial z-10"></div>
        </div>
        <div class="flex flex-col">
          <span class="font-bold">site info</span>
          <span>this site is built with 
            <span class="text-red-400">astro</span>,
            <span class="text-blue-500">jquery</span>,
            <span class="text-blue-100">react</span>,
            <span class="text-blue-300">tailwind</span>, and
            <span class="text-yellow-300">threejs</span>.
          </span>
          <span>to see the previous version of this site, visit <a class="font-serif hover:underline" href="/old">/old</a>.</span>
          <a href="https://github.com/ronthekiehn/ronkiehn.dev" target="_blank" rel="noreferrer" class="w-fit hover:underline">view the source code here</a>
        </div>
      </div>
    		

		</div>
    <div id="switcher" class="relative rounded-full h-[40px] max-w-xs mx-auto bg-gray-600 flex justify-center items-center mt-8 mb-4">
      <div class="absolute inset-0 bg-gradient-radial z-0 rounded-full"></div>
      <div class="relative m-[2px] bg-black w-full h-[36px] rounded-full z-10 flex justify-between items-center">
        <div id="slider" class="absolute bg-gray-600 h-[36px] w-1/3 rounded-full transition-all duration-200 ease-in-out">
          <div class="absolute inset-0 bg-gradient-radial opacity-50 z-10 rounded-full"></div>
        </div>
        <button id="projects-btn" class="hover:underline relative h-full w-full px-3 text-white rounded-full transition-colors z-20">Projects</button>
        <button id="chatbot-btn" class="hover:underline relative h-full w-full px-2 text-white rounded-full transition-colors z-20">Chatbot</button>
        <button id="blog-btn" class="hover:underline relative h-full w-full px-3 text-white rounded-full transition-colors z-20">Blog</button>
      </div>
    </div>

    <div id="content-container" class="mt-8">
      <div id="projects" class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-8 mt-10">
      {projects.map(project => (
        <Project {...project} />
      ))}
      </div>
      <div id="chatbot" class="relative mx-auto inset-0 bg-gray-600 rounded-[12px] max-w-4xl h-[75vh] hidden">
        <div class="absolute inset-0 bg-gradient-radial rounded-[12px] z-0"></div>
        <div class="relative m-[2px] top-[2px] bg-black rounded-[10.5px] z-10 h-[calc(75vh-4px)]">
          <ChatBot client:load />
        </div>
      </div>
      <div id="blog" class="h-screen hidden">
        <span>Coming soon!</span>
      </div>
    </div>

</Layout>

<script>
    import { initializeHover } from '../scripts/hover.js';
    initializeHover('.divider');
    initializeHover('#chatbot');
    initializeHover('#switcher');
    initializeHover('#slider');

   
    import $ from 'jquery';

    $(function() {
      $('#slider').css('left', '0');
      
      function switchTab(position: string, tabId: string) {
        $('#slider').css('left', position);
        $('#projects, #chatbot, #blog').addClass('hidden');
        $(tabId).removeClass('hidden');
      }

      $('#projects-btn').on('click', function() {
        switchTab('0', '#projects');
      });

      $('#chatbot-btn').on('click', function() {
        switchTab('33.33%', '#chatbot');
      });

      $('#blog-btn').on('click', function() {
        switchTab('66.66%', '#blog');
      });
    });
    


     import * as THREE from 'three'
    const scene = new THREE.Scene();
    
    const container = $('#cube-container');
    const containerSize = Math.min(container.width(), 300);
    
    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(containerSize, containerSize);
    renderer.setAnimationLoop(animate);

    const ambient = new THREE.DirectionalLight(0xffffff, 0.1);
    ambient.position.set(10, 10, 10);
    scene.add(ambient);
    const ambient2 = new THREE.AmbientLight(0xffffff, 0.1);
    scene.add(ambient2);

    const light = new THREE.SpotLight(0xffffff, 30);
    light.position.set(0, 0, 15); 
    light.angle = Math.PI / 16;
    light.penumbra = 1;
    light.decay = 1;
    light.distance = 30; 
    
    const lightTarget = new THREE.Object3D();
    lightTarget.position.set(0, 0, 0); 
    scene.add(lightTarget);
    light.target = lightTarget;
    scene.add(light);


    $('#cube-container').append(renderer.domElement);
    renderer.setClearColor(0x171717);

    // Create cube with consistent size
    const baseSize = 3;
    const geometry = new THREE.BoxGeometry(baseSize, baseSize, baseSize);
    const material = new THREE.MeshStandardMaterial({ color: 0xdddddd });
    
    const cube = new THREE.Mesh(geometry, material);
    scene.add(cube);

    camera.position.z = 5;

    // Create a function for the mousemove handler so we can reattach it
    $(document).on("mousemove", (e: JQuery.MouseMoveEvent) => {
      if (cube) {
        const container = $('#cube-container');
        const rect = container[0].getBoundingClientRect();
        
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        // Normalize mouse position to -1 to 1 range relative to container center
        const mousex = (e.clientX - centerX) / (rect.width * 2);
        const mousey = (e.clientY - centerY) / (rect.height * 2);
        
        // Calculate rotations
        const normalizedX = Math.min(Math.max(mousex, -1), 1);
        const normalizedY = Math.min(Math.max(mousey, -1), 1);
        
        const rotationY = -(Math.acos(normalizedX));
        const rotationX = Math.acos(normalizedY);
        
        cube.rotation.z = rotationX;
        cube.rotation.y = rotationY;

        // Update light position
        const vector = new THREE.Vector3(
          ((e.clientX - rect.left) / rect.width) * 2 - 1,
          -((e.clientY - rect.top) / rect.height) * 2 + 1,
          0.5
        );
        
        vector.unproject(camera);
        vector.sub(camera.position).normalize();
        
        const distance = -camera.position.z / vector.z;
        const targetPos = camera.position.clone().add(vector.multiplyScalar(distance));
        
        lightTarget.position.copy(targetPos);
        light.position.set(targetPos.x, targetPos.y, 15);
      }
    });

    // Update resize handler
    $(window).on('resize', () => {
        const container = $('#cube-container');
        const newSize = Math.min(container.width(), 300);
        
        renderer.setSize(newSize, newSize);
        camera.aspect = 1;
        camera.updateProjectionMatrix();
    });

    function animate() {
        renderer.render(scene, camera);
    }
  </script>